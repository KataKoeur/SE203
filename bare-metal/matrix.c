//matrix.c

#include "matrix.h"

void matrix_init()
{
   //activation horloge port A B C et D
   SIM_SCGC5 = SIM_SCGC5 | 0x00001e00;

   //mode GPIO
   PORTB_PCR0  = (PORTB_PCR0  | 0x00000100) & ~0x00000600;
   PORTB_PCR1  = (PORTB_PCR1  | 0x00000100) & ~0x00000600;
   PORTB_PCR2  = (PORTB_PCR2  | 0x00000100) & ~0x00000600;
   PORTC_PCR8  = (PORTC_PCR8  | 0x00000100) & ~0x00000600;
   PORTC_PCR9  = (PORTC_PCR9  | 0x00000100) & ~0x00000600;
   PORTA_PCR13 = (PORTA_PCR13 | 0x00000100) & ~0x00000600;
   PORTD_PCR2  = (PORTD_PCR2  | 0x00000100) & ~0x00000600;
   PORTD_PCR4  = (PORTD_PCR4  | 0x00000100) & ~0x00000600;
   PORTD_PCR6  = (PORTD_PCR6  | 0x00000100) & ~0x00000600;
   PORTD_PCR7  = (PORTD_PCR7  | 0x00000100) & ~0x00000600;
   PORTD_PCR5  = (PORTD_PCR5  | 0x00000100) & ~0x00000600;
   PORTA_PCR12 = (PORTA_PCR12 | 0x00000100) & ~0x00000600;
   PORTA_PCR4  = (PORTA_PCR4  | 0x00000100) & ~0x00000600;

   //mode sortie
   GPIOA_PDDR = GPIOA_PDDR | 0x00003010;
   GPIOB_PDDR = GPIOB_PDDR | 0x00000007;
   GPIOC_PDDR = GPIOC_PDDR | 0x00000180;
   GPIOD_PDDR = GPIOD_PDDR | 0x000000f4;

   //valeurs acceptables
   GPIOA_PCOR = 0x00003010;
   GPIOB_PCOR = 0x00000004;
   GPIOB_PSOR = 0x00000003;
   GPIOC_PCOR = 0x00000300;
   GPIOD_PCOR = 0x000000f4;
   //100ms d'attente
   GPIOB_PSOR = 0x00000004;
}                                   
